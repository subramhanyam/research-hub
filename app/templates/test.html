<!DOCTYPE html>
<html class="light" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ResearchHub X | Workspace Dashboard</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet"/>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#14532d", // Forest Green
                        "background-light": "#f8fafc",
                        "background-dark": "#0f172a",
                        secondary: "#15803d",
                        accent: "#bbf7d0",
                    },
                    fontFamily: {
                        display: ["Inter", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "1rem",
                        'xl': '1.5rem',
                        '2xl': '2rem',
                    },
                },
            },
        };
    </script>
<style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
        }
        .dark .glass-card {
            background: rgba(30, 41, 59, 0.7);
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        @keyframes rhx-pop-in {
            0% { transform: scale(0.7); opacity: 0.3; }
            70% { transform: scale(1.15); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .rhx-pop-in {
            animation: rhx-pop-in 0.45s ease-out;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 min-h-screen transition-colors duration-200">
<div class="flex h-screen overflow-hidden">
{% include "partials/test_sidebar.html" %}
<main class="flex-1 flex flex-col min-w-0 overflow-hidden">
{% include "partials/test_topbar.html" %}
<div class="flex-1 overflow-y-auto p-8 custom-scrollbar">
<div class="mb-8">
<h2 class="text-3xl font-bold mb-1">Research Dashboard</h2>
<p class="text-slate-500 dark:text-slate-400">Analyze progress and discover new research gaps in your workspace.</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
<div class="bg-primary p-6 rounded-2xl text-white relative overflow-hidden group">
<div class="relative z-10">
<div class="flex justify-between items-start mb-4">
<p class="text-accent/80 text-sm font-medium uppercase tracking-wider">Total Papers</p>
<span class="material-icons-outlined bg-white/20 p-1.5 rounded-lg text-sm">open_in_new</span>
</div>
<h3 class="text-4xl font-bold" id="test-kpi-papers">0</h3>
<p class="text-xs text-accent/60 mt-2 flex items-center gap-1">
<span class="material-icons-outlined text-xs">trending_up</span>
                                Live workspace count
                            </p>
</div>
<div class="absolute -bottom-8 -right-8 w-24 h-24 bg-accent/20 rounded-full blur-2xl"></div>
</div>
<div class="bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm">
<div class="flex justify-between items-start mb-4">
<p class="text-slate-400 dark:text-slate-500 text-sm font-medium uppercase tracking-wider">Missions Run</p>
<span class="material-icons-outlined text-slate-300 dark:text-slate-600 bg-slate-50 dark:bg-slate-700 p-1.5 rounded-lg text-sm">auto_awesome</span>
</div>
<h3 class="text-4xl font-bold" id="test-kpi-missions">0</h3>
<p class="text-xs text-secondary mt-2 flex items-center gap-1 font-medium">
<span class="material-icons-outlined text-xs">check_circle</span>
                            Mission history entries
                        </p>
</div>
<div class="bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm">
<div class="flex justify-between items-start mb-4">
<p class="text-slate-400 dark:text-slate-500 text-sm font-medium uppercase tracking-wider">Gaps Found</p>
<span class="material-icons-outlined text-slate-300 dark:text-slate-600 bg-slate-50 dark:bg-slate-700 p-1.5 rounded-lg text-sm">bolt</span>
</div>
<h3 class="text-4xl font-bold" id="test-kpi-gaps">0</h3>
<p class="text-xs text-slate-500 dark:text-slate-400 mt-2 flex items-center gap-1">
                            Strong + weak gaps
                        </p>
</div>
<div class="bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm">
<div class="flex justify-between items-start mb-4">
<p class="text-slate-400 dark:text-slate-500 text-sm font-medium uppercase tracking-wider">Ideas Generated</p>
<span class="material-icons-outlined text-slate-300 dark:text-slate-600 bg-slate-50 dark:bg-slate-700 p-1.5 rounded-lg text-sm">lightbulb</span>
</div>
<h3 class="text-4xl font-bold" id="test-kpi-ideas">0</h3>
<p class="text-xs text-orange-500 mt-2 flex items-center gap-1 font-medium">
                            Workspace ideas count
                        </p>
</div>
</div>
<div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
<div class="lg:col-span-8 space-y-8">
<div class="bg-white dark:bg-slate-800 border-2 border-dashed border-slate-200 dark:border-slate-700 p-8 rounded-2xl flex flex-col items-center justify-center text-center group hover:border-primary transition-colors cursor-pointer" id="test-upload-dropzone">
<div class="w-16 h-16 bg-slate-50 dark:bg-slate-700 rounded-full flex items-center justify-center mb-4 group-hover:bg-accent/20 transition-colors">
<span class="material-icons-outlined text-slate-400 dark:text-slate-500 group-hover:text-primary transition-colors text-3xl">cloud_upload</span>
</div>
<h4 class="text-lg font-semibold mb-2">Upload Research Papers</h4>
<p class="text-sm text-slate-500 dark:text-slate-400 max-w-sm mx-auto mb-6">Drop PDFs here or click to browse. ResearchHub X will automatically extract concepts and map connections.</p>
<button class="px-6 py-2 bg-primary text-white font-medium rounded-xl hover:bg-secondary transition-all" id="test-upload-btn" type="button">Select Files</button>
<input accept=".pdf,.txt,.md" class="hidden" id="test-upload-input" multiple type="file"/>
<p class="text-xs text-slate-500 mt-3 min-h-4" id="test-upload-status"></p>
<div class="hidden w-full max-w-md mt-2" id="test-upload-progress-wrap">
<div class="flex items-center justify-between text-xs text-slate-600 dark:text-slate-300 mb-1">
<div class="flex items-center gap-1.5">
<span class="material-icons-outlined text-sm animate-spin" id="test-upload-progress-icon">autorenew</span>
<span id="test-upload-progress-text">Preparing upload...</span>
</div>
<span id="test-upload-progress-count">0%</span>
</div>
<div class="w-full h-2 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden">
<div class="h-full bg-primary transition-all duration-300 rounded-full" id="test-upload-progress-bar" style="width: 0%"></div>
</div>
</div>
</div>
<div class="bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm">
<div class="flex justify-between items-center mb-8">
<div>
<h4 class="font-bold text-lg">Knowledge Coverage</h4>
<p class="text-xs text-slate-500">Distribution of topics across uploaded papers</p>
</div>
<div class="flex gap-2">
<button class="px-3 py-1 text-xs font-medium border border-slate-200 dark:border-slate-700 rounded-lg">Week</button>
<button class="px-3 py-1 text-xs font-medium bg-slate-100 dark:bg-slate-700 rounded-lg">Month</button>
</div>
</div>
<div class="flex items-end justify-between h-48 gap-3">
<div class="w-full bg-slate-100 dark:bg-slate-700 rounded-t-lg relative group h-[40%]">
<div class="absolute inset-0 bg-primary/20 group-hover:bg-primary/40 rounded-t-lg transition-colors"></div>
<span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-slate-400">MON</span>
</div>
<div class="w-full bg-primary rounded-t-lg relative group h-[85%]">
<div class="absolute -top-10 left-1/2 -translate-x-1/2 bg-slate-900 text-white text-[10px] py-1 px-2 rounded opacity-0 group-hover:opacity-100 transition-opacity">74%</div>
<span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-slate-400 font-bold">TUE</span>
</div>
<div class="w-full bg-slate-100 dark:bg-slate-700 rounded-t-lg h-[60%] relative group">
<div class="absolute inset-0 bg-secondary/30 group-hover:bg-secondary/50 rounded-t-lg transition-colors"></div>
<span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-slate-400">WED</span>
</div>
<div class="w-full bg-primary/90 rounded-t-lg h-[95%] relative group">
<span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-slate-400">THU</span>
</div>
<div class="w-full bg-slate-100 dark:bg-slate-700 rounded-t-lg h-[45%] relative group">
<span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-slate-400">FRI</span>
</div>
<div class="w-full bg-slate-100 dark:bg-slate-700 rounded-t-lg h-[30%] relative group border-2 border-dashed border-slate-300 dark:border-slate-600">
<span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-slate-400">SAT</span>
</div>
<div class="w-full bg-slate-100 dark:bg-slate-700 rounded-t-lg h-[25%] relative group border-2 border-dashed border-slate-300 dark:border-slate-600">
<span class="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-slate-400">SUN</span>
</div>
</div>
</div>
</div>
<div class="lg:col-span-4 space-y-6">
<div class="bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm">
<div class="flex justify-between items-center mb-6">
<h4 class="font-bold">Current Research Goal</h4>
<button class="text-primary hover:bg-accent/30 p-1 rounded-lg transition-colors">
<span class="material-icons-outlined text-sm">edit</span>
</button>
</div>
<div class="mb-6">
<div class="flex items-center gap-3 mb-2">
<div class="w-10 h-10 rounded-full border-4 border-primary border-r-slate-200 dark:border-r-slate-700 flex items-center justify-center text-[10px] font-bold">
                                        72%
                                    </div>
<div>
<p class="text-sm font-semibold">Post-Quantum Cryptography</p>
<p class="text-[10px] text-slate-500 uppercase tracking-wide">Target: Q4 Review</p>
</div>
</div>
<p class="text-xs text-slate-500 dark:text-slate-400 leading-relaxed italic border-l-2 border-primary/30 pl-3">"Investigating lattice-based methods for secure data transmission in decentralized networks."</p>
</div>
<button class="w-full py-2.5 bg-slate-50 dark:bg-slate-700 text-slate-700 dark:text-slate-300 text-xs font-semibold rounded-xl hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors">Update Strategic Plan</button>
</div>
<div class="bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm">
<div class="flex justify-between items-center mb-4">
<h4 class="font-bold">Recent Papers</h4>
<a class="text-xs font-semibold text-primary" href="/test/papers">View All</a>
</div>
<div class="space-y-4" id="test-recent-papers-list">
<div class="text-xs text-slate-400">No uploaded papers yet.</div>
</div>
</div>
<div class="bg-slate-900 rounded-2xl p-6 text-white relative overflow-hidden">
<div class="relative z-10">
<p class="text-[10px] uppercase tracking-widest text-slate-400 mb-2 font-bold">Active Deep-Read Session</p>
<div class="flex items-center justify-between mb-4">
<div>
<h5 class="text-3xl font-mono font-bold" id="test-deepread-timer">00:00:00</h5>
<p class="text-[11px] text-slate-400 mt-1" id="test-deepread-status">Stopped</p>
</div>
<div class="flex gap-2">
<button class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20" id="test-deepread-toggle" title="Start or pause timer" type="button">
<span class="material-icons-outlined text-sm" id="test-deepread-toggle-icon">play_arrow</span>
</button>
<button class="w-8 h-8 rounded-full bg-red-500/80 flex items-center justify-center hover:bg-red-500" id="test-deepread-stop" title="Stop and reset timer" type="button">
<span class="material-icons-outlined text-sm">stop</span>
</button>
</div>
</div>
<div class="h-1 w-full bg-white/10 rounded-full overflow-hidden">
<div class="h-full bg-primary transition-all duration-500" id="test-deepread-progress" style="width: 0%"></div>
</div>
</div>
<div class="absolute inset-0 opacity-20 pointer-events-none">
<svg height="100%" width="100%" xmlns="http://www.w3.org/2000/svg">
<defs>
<pattern height="20" id="grid" patternUnits="userSpaceOnUse" width="20">
<path d="M 20 0 L 0 0 0 20" fill="none" stroke="white" stroke-width="0.5"></path>
</pattern>
</defs>
<rect fill="url(#grid)" height="100%" width="100%"></rect>
</svg>
</div>
</div>
</div>
</div>
</div>
</main>
</div>

<script src="/static/test_ui.js"></script>
<script>
    const TEST_ACTIVE_SESSION_KEY = "researchpilot.active_session_id";

    async function fetchLatestSessionId() {
        try {
            const fromStorage = localStorage.getItem(TEST_ACTIVE_SESSION_KEY);
            if (fromStorage) return fromStorage;
        } catch (e) { /* ignore */ }

        try {
            const resp = await fetch("/api/sessions");
            if (!resp.ok) return null;
            const data = await resp.json();
            const sessions = Array.isArray(data.sessions) ? data.sessions : [];
            return sessions.length ? sessions[0].session_id : null;
        } catch (e) {
            return null;
        }
    }

    function setKpis({ papers = 0, missions = 0, gaps = 0, ideas = 0 }) {
        const papersEl = document.getElementById("test-kpi-papers");
        const missionsEl = document.getElementById("test-kpi-missions");
        const gapsEl = document.getElementById("test-kpi-gaps");
        const ideasEl = document.getElementById("test-kpi-ideas");
        if (papersEl) papersEl.textContent = String(papers);
        if (missionsEl) missionsEl.textContent = String(missions);
        if (gapsEl) gapsEl.textContent = String(gaps);
        if (ideasEl) ideasEl.textContent = String(ideas);
    }

    async function syncTestKpis() {
        const sessionId = await fetchLatestSessionId();
        if (!sessionId) {
            setKpis({});
            return;
        }

        try {
            const resp = await fetch(`/api/workspace/${sessionId}`);
            if (!resp.ok) {
                setKpis({});
                return;
            }

            const data = await resp.json();
            const papers = (data.papers || []).length;
            const missions = (data.missions || []).length;
            const gaps = (data.gaps || []).length + (data.weak_gaps || []).length;
            const ideas = (data.ideas || []).length;
            setKpis({ papers, missions, gaps, ideas });
        } catch (e) {
            setKpis({});
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        syncTestKpis();
        setInterval(syncTestKpis, 5000);
    });
</script>
</body></html>
